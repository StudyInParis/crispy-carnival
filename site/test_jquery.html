<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Test jQuery</title>
  <script src="./scripts_js/jquery.js"></script>
</head>
<body>

<div id="titre">Test 1</div>
<div id="visu1"></div>

<textarea id="source" style="width:650px;height:450px;" >
</textarea>




<script>

$.ajax({
  url: "https://raw.githubusercontent.com/StudyInParis/geoapplide/master/xml_formattes_pivot/xml_pivot.xml",
  cache: true
})
  .done(function( html ) {
    $("#source").val( html ) ;
  });

    var xml=$("#source").val(),
    xmlDoc = $.parseXML( xml ),
    $xml = $( xmlDoc );

// crée un tableau avec tous les types
var types = new Object() ;
$(xml).find('arrondissement').each(function(){
	var arro = $(this).attr("num") ;
	$(this).find('element').each( function(){
		var type = $(this).attr("type") ;
    types[type] = type;
	});
});
console.log(types);

// créé un tableau avec tous les arrondissements
var arrs = new Array();
var i =0;
$(xml).find('arrondissement').each(function(){
  var arro = $(this).attr("num") ;
  arrs[i] = arro;
  i++;
  });
console.log(arrs);

// création des boites arrondissements
$.each( arrs, function( key, value ) {
  $("#visu1").append('<div id="'+value+'" style="border:1px solid #808080"><h3>'+value+'</h3></div>');
  var temp = value ;
  $.each(types, function(key, value) {
    $("#"+temp).append('<div class="arro" id="titre-'+temp + value+'" style="clear:both">'+value+'</div>');
    $("#"+temp).append('<div class="content-arro" id="'+ temp + value+'"></div>');
  });
});


$(xml).find('arrondissement').each(function(){
	var arro = $(this).attr("num") ;
	$(this).find('element').each( function(){
		var id = $(this).attr('id') ;
		var nom = $(this).find('nom').text() ;
		var adr = $(this).find("adresse").text() ;
		var type = $(this).attr("type") ;
    $("#"+arro+type).append('<div class="element '+type+'" id="'+id+'" style="margin:5px; border:1px dashed #cacaca; width:200px; float:left; height:75px; padding:5px">'+nom+'<div class="adresse" id="'+id+'-adresse">'+adr+'</div></div>')
	});
});

$( "div.element" )
  .mouseover(function() {
    $( this ).css("background-color","#FEC606");
    $( "#"+$(this).attr("id")+"-adresse" ).show();
  })
  .mouseout(function() {
    $( this ).css("background-color","#FFF");
    $( "#"+$(this).attr("id")+"-adresse" ).hide();
    $(".cinema").css("background-color","#D4DBC8") ;
    $(".marche").css("background-color","#BD8D46") ;
    $(".cafe").css("background-color","#B0CC99") ;
    $(".bibli").css("background-color","#C4D7ED") ;
    $(".preservatifs").css("background-color","#9E8479") ;
    $(".bar").css("background-color","#EACFB8") ;
    $(".crous").css("background-color","#FFD940") ;
  });

$(".adresse").hide();

$(".cinema").css("background-color","#E6E2AF") ;
$(".marche").css("background-color","#BD8D46") ;
$(".cafe").css("background-color","#B0CC99") ;
$(".bibli").css("background-color","#C4D7ED") ;
$(".preservatifs").css("background-color","#9E8479") ;
$(".bar").css("background-color","#EACFB8") ;
$(".crous").css("background-color","#FFD940") ;


</script>

</body>
</html>
